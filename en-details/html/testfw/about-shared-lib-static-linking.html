<!doctype html>
<html >
<head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/template.css" />

    <link href="https://vjs.zencdn.net/5.4.4/video-js.css" rel="stylesheet" />

    <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>

    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.cookie.js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.hoverIntent.minified.js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.dcjqaccordion.2.7.min.js'></script>

    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/blue.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/graphite.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/grey.css" rel="stylesheet" type="text/css" />
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/script.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/jquery.sticky-kit.js"></script>

    <style type="text/css">
        /* TOC のスクロールバーを常にビューポート全高にする。
           sticky-kit の挙動 (ヘッダ考慮・ページ下部処理) はそのまま維持する。 */
        @media (min-width: 768px) {
            #TOC {
                height: 100vh;
                box-sizing: border-box;
            }
        }
    </style>

    <meta name="generator" content="pandoc" />
  <meta name="author" content="github-actions[bot]" />
  <title>共有ライブラリビルド時の静的ライブラリ組み込み機能</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../html-style.css" />
</head>
<body>

    
    <div class="navbar navbar-static-top">
    <div class="navbar-inner">
      <div class="container">
        <span class="doc-title">共有ライブラリビルド時の静的ライブラリ組み込み機能</span>
        <ul class="nav pull-right doc-info">
                    <li><p class="navbar-text">github-actions[bot]</p></li>
                              <li><p class="navbar-text">Sun, 1 Mar 2026 21:06:51 +0000 cbf6a8f</p></li>
                  </ul>
      </div>
    </div>
  </div>
    <div class="container">
    <div class="row">
            <div id="TOC" class="span3">
        <div class="well toc">

        <div class="toc-navi">
          <a href="javascript:history.back()">BACK</a>&nbsp;
          <a href="../index.html">HOME</a>
        </div>

                <ul>
                <li><a href="#概要-overview" id="toc-概要-overview"><span class="toc-section-number">1</span> 概要 / Overview</a></li>
                <li><a href="#背景目的-background-and-purpose" id="toc-背景目的-background-and-purpose"><span class="toc-section-number">2</span> 背景・目的 / Background and Purpose</a>
                <ul>
                <li><a href="#課題-problem" id="toc-課題-problem"><span class="toc-section-number">2.1</span> 課題 / Problem</a></li>
                <li><a href="#目的-purpose" id="toc-目的-purpose"><span class="toc-section-number">2.2</span> 目的 / Purpose</a></li>
                </ul></li>
                <li><a href="#機能仕様-functional-specification" id="toc-機能仕様-functional-specification"><span class="toc-section-number">3</span> 機能仕様 / Functional Specification</a>
                <ul>
                <li><a href="#基本動作-basic-behavior" id="toc-基本動作-basic-behavior"><span class="toc-section-number">3.1</span> 基本動作 / Basic Behavior</a></li>
                <li><a href="#ライブラリ検索パス-library-search-path" id="toc-ライブラリ検索パス-library-search-path"><span class="toc-section-number">3.2</span> ライブラリ検索パス / Library Search Path</a></li>
                <li><a href="#動作フロー-operation-flow" id="toc-動作フロー-operation-flow"><span class="toc-section-number">3.3</span> 動作フロー / Operation Flow</a></li>
                </ul></li>
                <li><a href="#使用例-usage-examples" id="toc-使用例-usage-examples"><span class="toc-section-number">4</span> 使用例 / Usage Examples</a>
                <ul>
                <li><a href="#例1-libsdir-を使用-example-1-using-libsdir" id="toc-例1-libsdir-を使用-example-1-using-libsdir"><span class="toc-section-number">4.1</span> 例1: LIBSDIR を使用 / Example 1: Using LIBSDIR</a></li>
                <li><a href="#例2--l-オプションを使用-example-2-using--l-option" id="toc-例2--l-オプションを使用-example-2-using--l-option"><span class="toc-section-number">4.2</span> 例2: -L オプションを使用 / Example 2: Using -L option</a></li>
                <li><a href="#例3-直接-.a-を指定-example-3-direct-.a-specification" id="toc-例3-直接-.a-を指定-example-3-direct-.a-specification"><span class="toc-section-number">4.3</span> 例3: 直接 .a を指定 / Example 3: Direct .a specification</a></li>
                <li><a href="#例4-混在パターン-example-4-mixed-pattern" id="toc-例4-混在パターン-example-4-mixed-pattern"><span class="toc-section-number">4.4</span> 例4: 混在パターン / Example 4: Mixed pattern</a></li>
                </ul></li>
                <li><a href="#依存関係の自動更新-automatic-dependency-updates" id="toc-依存関係の自動更新-automatic-dependency-updates"><span class="toc-section-number">5</span> 依存関係の自動更新 / Automatic Dependency Updates</a></li>
                <li><a href="#制限事項-limitations" id="toc-制限事項-limitations"><span class="toc-section-number">6</span> 制限事項 / Limitations</a>
                <ul>
                <li><a href="#検索対象は-.a-のみ" id="toc-検索対象は-.a-のみ"><span class="toc-section-number">6.1</span> 1. 検索対象は <code>.a</code> のみ</a></li>
                <li><a href="#検索パスの順序" id="toc-検索パスの順序"><span class="toc-section-number">6.2</span> 2. 検索パスの順序</a></li>
                <li><a href="#アーキテクチャ依存パス" id="toc-アーキテクチャ依存パス"><span class="toc-section-number">6.3</span> 3. アーキテクチャ依存パス</a></li>
                <li><a href="#lib_typestatic-には影響なし" id="toc-lib_typestatic-には影響なし"><span class="toc-section-number">6.4</span> 4. LIB_TYPE=static には影響なし</a></li>
                </ul></li>
                <li><a href="#実装ファイル-implementation-file" id="toc-実装ファイル-implementation-file"><span class="toc-section-number">7</span> 実装ファイル / Implementation File</a></li>
                <li><a href="#参考-references" id="toc-参考-references"><span class="toc-section-number">8</span> 参考 / References</a></li>
                </ul>
        
        </div>
      </div>
            <div class="span9">

                <H1>共有ライブラリビルド時の静的ライブラリ組み込み機能</H1>
      
      
      <p>Shared Library Build with Static Library Embedding</p>
<h1 data-number="1" id="概要-overview"><span class="header-section-number">1</span> 概要 / Overview</h1>
<p><code>makelibsrc.mk</code> の <code>LIB_TYPE=shared</code> オプションにおいて、<code>LIBS</code> に指定された <code>.a</code> ファイル（静的ライブラリ）を共有ライブラリに自動的に静的リンクする機能が実装されています。</p>
<p>When building shared libraries with <code>LIB_TYPE=shared</code> in <code>makelibsrc.mk</code>, <code>.a</code> files (static libraries) specified in <code>LIBS</code> are automatically statically linked into the shared library.</p>
<h1 data-number="2" id="背景目的-background-and-purpose"><span class="header-section-number">2</span> 背景・目的 / Background and Purpose</h1>
<h2 data-number="2.1" id="課題-problem"><span class="header-section-number">2.1</span> 課題 / Problem</h2>
<p>共有ライブラリ <code>libcalc.so</code> が静的ライブラリ <code>libcalcbase.a</code> の関数を参照する場合、以下の2つのアプローチがあります：</p>
<p>When a shared library <code>libcalc.so</code> references functions from a static library <code>libcalcbase.a</code>, there are two approaches:</p>
<p><strong>1. 共有ライブラリビルド時に静的リンク（推奨）</strong><br />
- <code>libcalc.so</code> に <code>libcalcbase.a</code> の内容を組み込む<br />
- 最終アプリケーションは <code>libcalc.so</code> のみをリンクすればよい<br />
- 依存関係が共有ライブラリ内で完結</p>
<p><strong>2. 最終アプリケーションで両方をリンク</strong><br />
- <code>libcalc.so</code> は未解決シンボルを含む<br />
- 最終アプリケーションが両方のライブラリをリンク<br />
- 配布時に複数のライブラリが必要となり管理が煩雑</p>
<p><strong>Option 1: Static linking during shared library build (recommended)</strong><br />
- Embed <code>libcalcbase.a</code> contents into <code>libcalc.so</code><br />
- Final application only needs to link <code>libcalc.so</code><br />
- Dependencies are encapsulated within the shared library</p>
<p><strong>Option 2: Link both libraries in final application</strong><br />
- <code>libcalc.so</code> contains unresolved symbols<br />
- Final application must link both libraries<br />
- Distribution becomes complex, requiring multiple libraries</p>
<h2 data-number="2.2" id="目的-purpose"><span class="header-section-number">2.2</span> 目的 / Purpose</h2>
<p>オプション1（推奨アプローチ）を自動的に実現します。<code>LIBS</code> に指定された静的ライブラリを共有ライブラリに組み込むことで、依存関係の管理を簡素化します。</p>
<p>This feature automatically implements option 1 (the recommended approach). By embedding static libraries specified in <code>LIBS</code>, it simplifies dependency management.</p>
<h1 data-number="3" id="機能仕様-functional-specification"><span class="header-section-number">3</span> 機能仕様 / Functional Specification</h1>
<h2 data-number="3.1" id="基本動作-basic-behavior"><span class="header-section-number">3.1</span> 基本動作 / Basic Behavior</h2>
<table>
<thead>
<tr>
<th>LIBS の記述形式</th>
<th>処理方法</th>
<th>例</th>
</tr>
</thead>
<tbody>
<tr>
<td>直接 <code>.a</code> 指定</td>
<td>静的リンク</td>
<td><code>libcalcbase.a</code></td>
</tr>
<tr>
<td><code>-l</code> で <code>.a</code> に解決</td>
<td>静的リンク</td>
<td><code>-lcalcbase</code> → <code>libcalcbase.a</code></td>
</tr>
<tr>
<td><code>-l</code> で <code>.so</code> に解決</td>
<td>動的リンク</td>
<td><code>-lm</code> → <code>libm.so</code></td>
</tr>
<tr>
<td><code>.so</code> 直接指定</td>
<td>動的リンク</td>
<td><code>libfoo.so</code></td>
</tr>
<tr>
<td><code>-L</code> オプション</td>
<td>検索パスとして使用</td>
<td><code>-L/path/to/libs</code></td>
</tr>
<tr>
<td>その他リンクオプション</td>
<td>そのまま渡す</td>
<td><code>-Wl,-rpath,/path</code></td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col style="width: 38%" />
<col style="width: 35%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr>
<th>LIBS format</th>
<th>Processing</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>Direct <code>.a</code> specification</td>
<td>Static linking</td>
<td><code>libcalcbase.a</code></td>
</tr>
<tr>
<td><code>-l</code> resolves to <code>.a</code></td>
<td>Static linking</td>
<td><code>-lcalcbase</code> → <code>libcalcbase.a</code></td>
</tr>
<tr>
<td><code>-l</code> resolves to <code>.so</code></td>
<td>Dynamic linking</td>
<td><code>-lm</code> → <code>libm.so</code></td>
</tr>
<tr>
<td>Direct <code>.so</code> specification</td>
<td>Dynamic linking</td>
<td><code>libfoo.so</code></td>
</tr>
<tr>
<td><code>-L</code> option</td>
<td>Used as search path</td>
<td><code>-L/path/to/libs</code></td>
</tr>
<tr>
<td>Other link options</td>
<td>Passed as-is</td>
<td><code>-Wl,-rpath,/path</code></td>
</tr>
</tbody>
</table>
<h2 data-number="3.2" id="ライブラリ検索パス-library-search-path"><span class="header-section-number">3.2</span> ライブラリ検索パス / Library Search Path</h2>
<p><code>-l</code> オプションで指定されたライブラリは、以下の順序で <code>.a</code> ファイルを検索します：</p>
<p>Libraries specified with <code>-l</code> are searched for <code>.a</code> files in the following order:</p>
<ol type="1">
<li><p><code>LIBSDIR</code> で指定されたパス</p></li>
<li><p><code>LIBS</code> 内の <code>-L</code> オプションで指定されたパス</p></li>
<li><p><code>$(WORKSPACE_FOLDER)/test/lib</code></p></li>
<li><p>システムライブラリパス (<code>/usr/lib</code>, <code>/usr/local/lib</code>, <code>/lib</code>, etc.)</p></li>
<li><p>Paths specified in <code>LIBSDIR</code></p></li>
<li><p>Paths specified with <code>-L</code> option in <code>LIBS</code></p></li>
<li><p><code>$(WORKSPACE_FOLDER)/test/lib</code></p></li>
<li><p>System library paths (<code>/usr/lib</code>, <code>/usr/local/lib</code>, <code>/lib</code>, etc.)</p></li>
</ol>
<p>最初に見つかった <code>.a</code> ファイルが使用されます。見つからない場合は <code>-l</code> オプションとして動的リンクされます。</p>
<p>The first found <code>.a</code> file is used. If not found, it remains as <code>-l</code> option for dynamic linking.</p>
<h2 data-number="3.3" id="動作フロー-operation-flow"><span class="header-section-number">3.3</span> 動作フロー / Operation Flow</h2>
<figure>
<img src="puml_be3f6e87ace3efb0ec4d9237832063f377716262.svg" alt="plantuml" />
</figure>
<h1 data-number="4" id="使用例-usage-examples"><span class="header-section-number">4</span> 使用例 / Usage Examples</h1>
<h2 data-number="4.1" id="例1-libsdir-を使用-example-1-using-libsdir"><span class="header-section-number">4.1</span> 例1: LIBSDIR を使用 / Example 1: Using LIBSDIR</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">LIBSDIR</span> <span class="ch">=</span><span class="st"> </span><span class="ch">$(</span><span class="dt">WORKSPACE_FOLDER</span><span class="ch">)</span><span class="st">/prod/calc/lib</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="dt">LIBS</span> <span class="ch">=</span><span class="st"> -lcalcbase -lm</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="dt">LIB_TYPE</span> <span class="ch">=</span><span class="st"> shared</span></span></code></pre></div>
<p><strong>動作:</strong><br />
- <code>libcalcbase.a</code> が <code>prod/calc/lib</code> に存在 → 静的リンク<br />
- <code>-lm</code> → 動的リンク</p>
<p><strong>結果:</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-shared</span> <span class="at">-o</span> libcalc.so obj/<span class="pp">*</span>.o /path/to/libcalcbase.a <span class="at">-lm</span></span></code></pre></div>
<p><strong>Operation:</strong><br />
- <code>libcalcbase.a</code> found in <code>prod/calc/lib</code> → static linking<br />
- <code>-lm</code> → dynamic linking</p>
<h2 data-number="4.2" id="例2--l-オプションを使用-example-2-using--l-option"><span class="header-section-number">4.2</span> 例2: -L オプションを使用 / Example 2: Using -L option</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">LIBS</span> <span class="ch">=</span><span class="st"> -L</span><span class="ch">$(</span><span class="dt">WORKSPACE_FOLDER</span><span class="ch">)</span><span class="st">/test/lib -lcalcbase -lm</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="dt">LIB_TYPE</span> <span class="ch">=</span><span class="st"> shared</span></span></code></pre></div>
<p><strong>動作:</strong><br />
- <code>libcalcbase.a</code> が <code>test/lib</code> に存在 → 静的リンク<br />
- <code>-lm</code> → 動的リンク<br />
- <code>-L</code> オプションもリンクコマンドに渡される</p>
<p><strong>結果:</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-shared</span> <span class="at">-o</span> libcalc.so obj/<span class="pp">*</span>.o /path/to/libcalcbase.a <span class="at">-lm</span> <span class="at">-L</span>/path/to/test/lib</span></code></pre></div>
<p><strong>Operation:</strong><br />
- <code>libcalcbase.a</code> found in <code>test/lib</code> → static linking<br />
- <code>-lm</code> → dynamic linking<br />
- <code>-L</code> option is also passed to link command</p>
<h2 data-number="4.3" id="例3-直接-.a-を指定-example-3-direct-.a-specification"><span class="header-section-number">4.3</span> 例3: 直接 .a を指定 / Example 3: Direct .a specification</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dt">LIBS</span> <span class="ch">=</span><span class="st"> libcalcbase.a -lm</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="dt">LIB_TYPE</span> <span class="ch">=</span><span class="st"> shared</span></span></code></pre></div>
<p><strong>動作:</strong><br />
- <code>libcalcbase.a</code> を直接指定 → 静的リンク<br />
- <code>-lm</code> → 動的リンク</p>
<p><strong>結果:</strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-shared</span> <span class="at">-o</span> libcalc.so obj/<span class="pp">*</span>.o libcalcbase.a <span class="at">-lm</span></span></code></pre></div>
<p><strong>Operation:</strong><br />
- <code>libcalcbase.a</code> directly specified → static linking<br />
- <code>-lm</code> → dynamic linking</p>
<h2 data-number="4.4" id="例4-混在パターン-example-4-mixed-pattern"><span class="header-section-number">4.4</span> 例4: 混在パターン / Example 4: Mixed pattern</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dt">LIBS</span> <span class="ch">=</span><span class="st"> libbase.a -L/custom/path -lcustom -lpthread -Wl,-rpath,/opt/lib</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="dt">LIB_TYPE</span> <span class="ch">=</span><span class="st"> shared</span></span></code></pre></div>
<p><strong>動作:</strong><br />
- <code>libbase.a</code> → 静的リンク（直接指定）<br />
- <code>-lcustom</code> → <code>/custom/path</code> に <code>.a</code> があれば静的リンク、なければ動的リンク<br />
- <code>-lpthread</code> → 動的リンク（通常 <code>.so</code> のみ存在）<br />
- <code>-Wl,-rpath,/opt/lib</code> → リンクオプションとしてそのまま渡される</p>
<p><strong>Operation:</strong><br />
- <code>libbase.a</code> → static linking (direct specification)<br />
- <code>-lcustom</code> → static linking if <code>.a</code> exists in <code>/custom/path</code>, otherwise dynamic<br />
- <code>-lpthread</code> → dynamic linking (usually only <code>.so</code> exists)<br />
- <code>-Wl,-rpath,/opt/lib</code> → passed as-is</p>
<h1 data-number="5" id="依存関係の自動更新-automatic-dependency-updates"><span class="header-section-number">5</span> 依存関係の自動更新 / Automatic Dependency Updates</h1>
<p>静的ライブラリが更新された場合、共有ライブラリも自動的に再ビルドされます。</p>
<p>When a static library is updated, the shared library is automatically rebuilt.</p>
<p><strong>例:</strong><br />
1. <code>libcalcbase.a</code> を変更<br />
2. <code>make</code> を実行<br />
3. <code>libcalc.so</code> が自動的に再ビルドされる</p>
<p><strong>Example:</strong><br />
1. Modify <code>libcalcbase.a</code><br />
2. Run <code>make</code><br />
3. <code>libcalc.so</code> is automatically rebuilt</p>
<h1 data-number="6" id="制限事項-limitations"><span class="header-section-number">6</span> 制限事項 / Limitations</h1>
<h2 data-number="6.1" id="検索対象は-.a-のみ"><span class="header-section-number">6.1</span> 1. 検索対象は <code>.a</code> のみ</h2>
<p><code>.a</code> ファイルのみを検索します。同名の <code>.so</code> と <code>.a</code> が存在する場合でも、<code>.a</code> が優先されます。</p>
<p>Only <code>.a</code> files are searched. Even if both <code>.so</code> and <code>.a</code> exist with the same name, <code>.a</code> is prioritized.</p>
<h2 data-number="6.2" id="検索パスの順序"><span class="header-section-number">6.2</span> 2. 検索パスの順序</h2>
<p>最初に見つかった <code>.a</code> ファイルが使用されます。複数のパスに同名のライブラリがある場合は、検索パスの順序（<code>LIBSDIR</code> → <code>-L</code> → <code>test/lib</code> → システムパス）に注意してください。</p>
<p>The first found <code>.a</code> file is used. When multiple paths contain libraries with the same name, be aware of the search order (<code>LIBSDIR</code> → <code>-L</code> → <code>test/lib</code> → system paths).</p>
<h2 data-number="6.3" id="アーキテクチャ依存パス"><span class="header-section-number">6.3</span> 3. アーキテクチャ依存パス</h2>
<p>x86_64 Linux 用のシステムライブラリパス（<code>/usr/lib/x86_64-linux-gnu</code> など）がハードコードされています。他のアーキテクチャでは、<code>makelibsrc.mk</code> の <code>ALL_LIB_DIRS</code> に適切なパスを追加する必要があります。</p>
<p>System library paths for x86_64 Linux (<code>/usr/lib/x86_64-linux-gnu</code>, etc.) are hardcoded. For other architectures, appropriate paths must be added to <code>ALL_LIB_DIRS</code> in <code>makelibsrc.mk</code>.</p>
<h2 data-number="6.4" id="lib_typestatic-には影響なし"><span class="header-section-number">6.4</span> 4. LIB_TYPE=static には影響なし</h2>
<p>この機能は <code>LIB_TYPE=shared</code> の場合のみ有効です。<code>LIB_TYPE=static</code>（デフォルト）の動作は変更されていません。</p>
<p>This feature is only active when <code>LIB_TYPE=shared</code>. The behavior of <code>LIB_TYPE=static</code> (default) is unchanged.</p>
<h1 data-number="7" id="実装ファイル-implementation-file"><span class="header-section-number">7</span> 実装ファイル / Implementation File</h1>
<p><strong>ファイル</strong>: <code>makefw/makefiles/makelibsrc.mk</code></p>
<p><strong>変更行</strong>: 162-210行目（共有ライブラリビルドルール部分）</p>
<p><strong>File</strong>: <code>makefw/makefiles/makelibsrc.mk</code></p>
<p><strong>Modified lines</strong>: Lines 162-210 (shared library build rules)</p>
<p>詳細な実装内容については、ソースコード内のコメントを参照してください。</p>
<p>For detailed implementation, refer to comments in the source code.</p>
<h1 data-number="8" id="参考-references"><span class="header-section-number">8</span> 参考 / References</h1>
<ul>
<li><p><strong>リンカーの挙動</strong>: <code>ld</code> は <code>.a</code> ファイルを直接指定すると静的リンクし、<code>-l</code> オプションは検索パスから <code>.so</code> または <code>.a</code> を探します</p></li>
<li><p><strong>依存関係管理</strong>: Make の自動依存関係解決機能により、静的ライブラリの更新を検知します</p></li>
<li><p><strong>Linker behavior</strong>: <code>ld</code> statically links when <code>.a</code> files are directly specified, while <code>-l</code> options search for <code>.so</code> or <code>.a</code> in search paths</p></li>
<li><p><strong>Dependency management</strong>: Make’s automatic dependency resolution detects static library updates</p></li>
</ul>
            </div>
    </div>
  </div>
  <script src="https://vjs.zencdn.net/5.4.4/video.js"></script>

  <!-- ============================================================
       展開可能リスト (collapsible-list) 変換スクリプト

       このスクリプトは .collapsible-list クラスを持つ要素内の
       ネストされたリストを <details>/<summary> 構造に変換します。

       - 対象: .collapsible-list 内の子要素 (<ul>/<ol>) を持つ <li>
       - 動作: デフォルトで折りたたみ、クリックで展開
       - 通常のリストには影響しません
       - ブラウザの「戻る」で状態を復元します (sessionStorage)

       詳細は docs-src/collapsible-list.md を参照してください。
       ============================================================ -->
  <script>
  (function() {
    document.addEventListener('DOMContentLoaded', function() {
      // .collapsible-list 内のすべての li 要素を処理
      var containers = document.querySelectorAll('.collapsible-list');
      containers.forEach(function(container) {
        var listItems = container.querySelectorAll('li');
        listItems.forEach(function(li) {
          // 子要素として ul または ol を持つかチェック
          var childList = li.querySelector(':scope > ul, :scope > ol');
          if (!childList) return;

          // 既に details でラップされている場合はスキップ
          if (li.querySelector(':scope > details')) return;

          // li の直接のテキストコンテンツと要素を取得
          var summaryContent = [];
          var nodesToMove = [];

          // 子ノードを走査
          Array.from(li.childNodes).forEach(function(node) {
            if (node === childList) return;
            if (node.nodeType === Node.TEXT_NODE ||
                (node.nodeType === Node.ELEMENT_NODE &&
                 node.tagName !== 'UL' && node.tagName !== 'OL')) {
              summaryContent.push(node.cloneNode(true));
              nodesToMove.push(node);
            }
          });

          // details/summary 構造を作成
          var details = document.createElement('details');
          var summary = document.createElement('summary');

          // summary にコンテンツを追加
          summaryContent.forEach(function(node) {
            summary.appendChild(node);
          });

          // 元のノードを削除
          nodesToMove.forEach(function(node) {
            li.removeChild(node);
          });

          // details 構造を組み立て
          details.appendChild(summary);

          // 子リストを details に移動
          li.removeChild(childList);
          details.appendChild(childList);

          // li に details を挿入
          li.insertBefore(details, li.firstChild);
        });
      });

      // ============================================================
      // 折りたたみ状態の保存・復元
      //
      // sessionStorage を使用して、ブラウザの「戻る」操作時に
      // 折りたたみ状態を復元します。
      // 初回表示時は全て折りたたみ (デフォルト)、
      // 「戻る」操作時のみ以前の状態を復元します。
      // ============================================================

      var storageKey = 'collapsible-state:' + window.location.pathname;
      var allDetails = document.querySelectorAll('.collapsible-list details');

      if (allDetails.length === 0) return;

      // ナビゲーション種別の判定: back_forward のみ状態を復元
      var isBackForward = false;
      try {
        var navEntries = performance.getEntriesByType('navigation');
        if (navEntries.length > 0) {
          isBackForward = navEntries[0].type === 'back_forward';
        } else if (performance.navigation) {
          // フォールバック (非推奨 API)
          isBackForward = performance.navigation.type === 2;
        }
      } catch (e) {
        // performance API が利用できない場合は復元しない
      }

      // 「戻る」操作時のみ状態を復元
      if (isBackForward) {
        try {
          var savedState = sessionStorage.getItem(storageKey);
          if (savedState) {
            var state = JSON.parse(savedState);
            allDetails.forEach(function(details, index) {
              if (state[index]) {
                details.open = true;
              }
            });
          }
        } catch (e) {
          // sessionStorage の読み込みエラーは無視
        }
      }

      // 状態変更時に sessionStorage へ保存
      function saveState() {
        try {
          var state = {};
          allDetails.forEach(function(details, index) {
            if (details.open) {
              state[index] = true;
            }
          });
          sessionStorage.setItem(storageKey, JSON.stringify(state));
        } catch (e) {
          // sessionStorage の書き込みエラーは無視
        }
      }

      allDetails.forEach(function(details) {
        details.addEventListener('toggle', saveState);
      });
    });
  })();
  </script>

</body>
</html>
